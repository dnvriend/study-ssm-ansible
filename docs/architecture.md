# Architecture Overview

## Layered Infrastructure

This project uses a layered approach to infrastructure management:

```
┌─────────────────────────────────────────────────────────────┐
│                    700-lambda                                │
│                 (Serverless Functions)                       │
└─────────────────────────────────────────────────────────────┘
                            │
┌─────────────────────────────────────────────────────────────┐
│                     600-dns                                  │
│              (Route53, ACM Certificates)                     │
└─────────────────────────────────────────────────────────────┘
                            │
┌─────────────────────────────────────────────────────────────┐
│                  500-application                             │
│              (ECS Services, App Config)                      │
└─────────────────────────────────────────────────────────────┘
                     │           │
         ┌───────────┘           └───────────┐
         │                                   │
┌────────┴────────┐                 ┌────────┴────────┐
│   300-compute    │                 │    400-data     │
│  (EC2, ALB, ECS) │                 │   (S3, RDS)     │
└────────┬────────┘                 └────────┬────────┘
         │                                   │
         └───────────┬───────────────────────┘
                     │
┌────────────────────┴────────────────────┐
│            100-network                   │
│       (VPC, Subnets, Routing)           │
└─────────────────────────────────────────┘
                     │
┌────────────────────┴────────────────────┐
│              200-iam                     │
│      (Roles, Policies, Profiles)        │
└─────────────────────────────────────────┘
```

## Network Architecture

```
                    ┌─────────────────────────────────────┐
                    │              Internet                │
                    └─────────────────┬───────────────────┘
                                      │
                    ┌─────────────────┴───────────────────┐
                    │         Internet Gateway            │
                    └─────────────────┬───────────────────┘
                                      │
┌─────────────────────────────────────┴─────────────────────────────────────┐
│                                  VPC                                       │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │                        Public Subnets                                │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                  │  │
│  │  │   AZ-a      │  │   AZ-b      │  │   AZ-c      │ (prod only)      │  │
│  │  │   ALB       │  │   ALB       │  │   ALB       │                  │  │
│  │  │   NAT GW    │  │   NAT GW    │  │   NAT GW    │                  │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                  │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│                                      │                                     │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │                       Private Subnets                                │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                  │  │
│  │  │   AZ-a      │  │   AZ-b      │  │   AZ-c      │ (prod only)      │  │
│  │  │   EC2/ECS   │  │   EC2/ECS   │  │   EC2/ECS   │                  │  │
│  │  │   RDS       │  │   RDS       │  │   RDS       │                  │  │
│  │  │   Lambda    │  │   Lambda    │  │   Lambda    │                  │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                  │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
└───────────────────────────────────────────────────────────────────────────┘
```

## State Management

```
┌─────────────────────────────────────────────────────────┐
│                     S3 Bucket                            │
│              {account_id}-tf-state                       │
│  ┌─────────────────────────────────────────────────────┐│
│  │ env:/dev/                                            ││
│  │   ├── terraform.100-network.tfstate                 ││
│  │   ├── terraform.200-iam.tfstate                     ││
│  │   └── ...                                            ││
│  ├─────────────────────────────────────────────────────┤│
│  │ env:/test/                                           ││
│  │   └── ...                                            ││
│  ├─────────────────────────────────────────────────────┤│
│  │ env:/prod/                                           ││
│  │   └── ...                                            ││
│  └─────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────┘
                          │
                          │ Locking
                          ▼
┌─────────────────────────────────────────────────────────┐
│               DynamoDB Table                             │
│         terraform_lock_{account_id}                      │
└─────────────────────────────────────────────────────────┘
```

## CI/CD Pipeline

```
┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐
│ Commit  │───▶│Validate │───▶│  Plan   │───▶│ Approve │
└─────────┘    └─────────┘    └─────────┘    └────┬────┘
                                                  │
                                                  │ Manual
                                                  ▼
                                            ┌─────────┐
                                            │  Apply  │
                                            └─────────┘
```
